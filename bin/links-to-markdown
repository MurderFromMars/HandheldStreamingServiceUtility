#!/usr/bin/env bash
# Convert pipe-delimited service index to markdown list

readonly INDEX_PATH="data/links.index"

format_markdown_link() {
    local raw_line="$1"
    local service_name url remainder
    
    # Extract service name (first field)
    service_name="${raw_line%%|*}"
    
    # Remove first field to get remainder
    remainder="${raw_line#*|}"
    
    # Extract URL (now first field of remainder)
    url="${remainder%%|*}"
    
    # Output formatted markdown
    printf "* [%s](%s)\n" "${service_name}" "${url}"
}

process_index() {
    local line
    
    while IFS= read -r line; do
        [[ -z "${line}" ]] && continue
        format_markdown_link "${line}"
    done < "${INDEX_PATH}"
}

process_index
